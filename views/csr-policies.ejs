<!doctype html>
<html lang="en" class="light-style layout-navbar-fixed layout-menu-fixed layout-compact" dir="ltr"
  data-theme="theme-default" data-assets-path="/" data-template="vertical-menu-template">

<head>
  <meta charset="utf-8" />
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />

  <title>CSR Policies | GTI Intranet</title>

  <meta name="description" content="" />

  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="/img/favicon/favicon.ico" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&ampdisplay=swap"
    rel="stylesheet" />

  <!-- Icons -->
  <link rel="stylesheet" href="/vendor/fonts/fontawesome.css" />
  <link rel="stylesheet" href="/vendor/fonts/tabler-icons.css" />
  <link rel="stylesheet" href="/vendor/fonts/flag-icons.css" />

  <!-- Core CSS -->
  <link rel="stylesheet" href="/vendor/css/rtl/core.css" class="template-customizer-core-css" />
  <link rel="stylesheet" href="/vendor/css/rtl/theme-default.css" class="template-customizer-theme-css" />
  <link rel="stylesheet" href="/css/demo.css" />

  <!-- Vendors CSS -->
  <link rel="stylesheet" href="/vendor/libs/node-waves/node-waves.css" />
  <link rel="stylesheet" href="/vendor/libs/perfect-scrollbar/perfect-scrollbar.css" />
  <link rel="stylesheet" href="/vendor/libs/typeahead-js/typeahead.css" />
  <link rel="stylesheet" href="/vendor/libs/datatables-bs5/datatables.bootstrap5.css" />
  <link rel="stylesheet" href="/vendor/libs/datatables-responsive-bs5/responsive.bootstrap5.css" />
  <link rel="stylesheet" href="/vendor/libs/datatables-select-bs5/select.bootstrap5.css" />
  <link rel="stylesheet" href="/vendor/libs/datatables-checkboxes-jquery/datatables.checkboxes.css" />
  <link rel="stylesheet" href="/vendor/libs/datatables-fixedcolumns-bs5/fixedcolumns.bootstrap5.css" />
  <link rel="stylesheet" href="/vendor/libs/datatables-fixedheader-bs5/fixedheader.bootstrap5.css" />
  <link rel="stylesheet" href="/vendor/libs/select2/select2.css" />
  <link rel="stylesheet" href="/vendor/libs/sweetalert2/sweetalert2.css" />
  <!-- DataTables CSS (latest version only) -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.8/css/jquery.dataTables.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.2/css/buttons.dataTables.min.css">

  <style>
  /* Export botones */
  div.dt-button-collection {
    background: var(--bs-card-bg, #23243a) !important;
    color: var(--bs-body-color, #fff) !important;
    border-radius: 0.5rem !important;
    box-shadow: 0 4px 24px rgba(0,0,0,0.18);
  }
  div.dt-button-collection .dt-button {
    color: var(--bs-body-color, #fff) !important;
  }
  div.dt-button-collection .dt-button:hover {
    background: var(--bs-primary, #5370f0) !important;
    color: #fff !important;
  }
  .dt-export-buttons {
    min-width: 160px;
    margin-right: 14px;
  }
  .dt-export-buttons .btn {
    margin-left: 12px;
    box-shadow: 0 2px 8px rgba(80,80,80,0.08);
    transition: box-shadow 0.2s;
  }
  .dt-export-buttons .btn:hover {
    box-shadow: 0 4px 24px rgba(80,80,80,0.13);
  }
  /* SUM */
  .datatable-summary-highlight-content {
    font-size: 1.8rem;
    color: #f5a706;
    font-weight: bold;
    text-align: center;
    letter-spacing: 1px;
  }
  /* DataTables paginación: sin borde, sin fondo, sin animación */
  .dataTables_wrapper .dataTables_paginate .paginate_button {
    border: none !important;
    background: transparent !important;
    box-shadow: none !important;
    outline: none !important;
    color: var(--bs-body-color, #fff) !important;
  }
  .dataTables_wrapper .dataTables_paginate .paginate_button.current,
  .dataTables_wrapper .dataTables_paginate .paginate_button:hover,
  .dataTables_wrapper .dataTables_paginate .paginate_button:focus,
  .dataTables_wrapper .dataTables_paginate .paginate_button:active {
    border: none !important;
    background: transparent !important;
    color: var(--bs-primary, #5370f0) !important;
    box-shadow: none !important;
    outline: none !important;
  }
  /* TABLA a todo el ancho */
  .card-datatable.table-responsive {
    max-width: none !important;
    margin: 0 !important;
  }
  /* Selector "Show X entries" bonito, grande y claro */
  .dataTables_length label {
    font-size: 1.13rem;
    font-weight: 500;
    color: #fff;
    display: flex;
    align-items: center;
    gap: 0.5em;
    letter-spacing: 0.01em;
  }
  .dataTables_length select {
    font-size: 1.18rem;
    font-weight: 600;
    min-width: 64px;
    padding: 0.25rem 2rem 0.25rem 0.85rem;
    height: 2.2rem;
    border-radius: 0.5rem;
    color: #23243a;
    background: #fff;
    border: 1.5px solid #f5a706;
    margin: 0 0.7em;
    box-shadow: 0 1px 6px rgba(245, 167, 6, 0.08);
    transition: border-color 0.2s, box-shadow 0.2s;
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg width='16' height='16' fill='gray' viewBox='0 0 16 16'%3E%3Cpath d='M4 6l4 4 4-4'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 0.7rem center;
    background-size: 1.1rem;
  }
  .dataTables_length select:focus {
    border-color: #f5a706;
    outline: none;
    box-shadow: 0 0 0 2.5px #f5a70655;
  }
  /* Modo oscuro para selector */
  @media (prefers-color-scheme: dark) {
    .dataTables_length label {
      color: #fff;
    }
    .dataTables_length select {
      background: #23243a;
      color: #f5a706;
      border: 1.5px solid #f5a706;
    }
  }
  @media (max-width: 600px) {
    .dataTables_length label {
      font-size: 1rem;
    }
    .dataTables_length select {
      font-size: 1.02rem;
      height: 2rem;
      padding-right: 1.3rem;
    }
  }


  </style>

  <script src="/vendor/js/helpers.js"></script>
  <script src="/vendor/js/template-customizer.js"></script>
  <script src="/js/config.js"></script>
</head>

<body>
<!-- Content wrapper -->
<div class="content-wrapper">

<!-- Content -->
<div class="container-xxl flex-grow-1 container-p-y">
 <%
function getGroupByLabel(val) {
  if (!val) return '';
  const l = val.toString().toLowerCase();
  if (l === 'c' || l === 'csr') return 'CSR';
  if (l === 'a' || l === 'agent') return 'Agent';
  if (l === 'p' || l === 'producer') return 'Producer';
  return val;
}
%>
<nav aria-label="breadcrumb">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><a href="/users/statistics/csr">CSR Ranking</a></li>
    <li class="breadcrumb-item active" aria-current="page">
      Policies for <%= getGroupByLabel(group_by_value) %>:
      <%= alias ? decodeURIComponent(alias) : decodeURIComponent(group_name) %>
    </li>
  </ol>
</nav>
<h3 class="mb-4">
  Policies for <%= getGroupByLabel(group_by_value) %>:
  <span class="text-primary">
    <%= alias ? decodeURIComponent(alias) : decodeURIComponent(group_name) %>
  </span>
</h3>

  <!-- Variables globales SOLO para lógica de franquicia/agente independiente -->
  <script>
    // Estas variables estarán disponibles para tu JS
    window.FRANCHISE_LOCATION_ID = '<%= user && user.location_id ? user.location_id : "" %>';
    window.IS_FRANCHISE = '<%= user && user.location_type === 2 ? "true" : "false" %>';
    window.IS_INDEPENDENT_AGENT = '<%= user && user.location_type === 4 ? "true" : "false" %>';
  </script>

 <div class="card">
  <div class="card-body">
    <div class="card-datatable table-responsive">
      <div class="row align-items-center mb-3">
        <div class="col-auto">
          <div class="navbar-nav align-items-center">
            <div class="nav-item navbar-search-wrapper mb-0">
              <input id="global-search" type="text" class="form-control" style="min-width:220px" placeholder="Search policies...">
            </div>
          </div>
        </div>
        <div class="col text-end"></div>
        <div class="col-auto d-flex justify-content-end align-items-center datatable-summary-col">
          <div id="datatable-summary" class="datatable-summary-highlight">
            <div class="datatable-summary-highlight-content">
              <span id="policy-count">0</span> &nbsp; | &nbsp; <span id="premium-sum">$0.00</span>
            </div>
          </div>
        </div>
      </div>
      <table id="csr-policies-table" class="table table-striped table-bordered" style="width:100%">
        <thead>
          <tr>
            <th class="text-nowrap" title="Customer">Customer</th>
            <th class="text-nowrap" title="Policy Number">P. Number</th>
            <th class="text-nowrap" title="Location">Location</th>
            <th class="text-nowrap" title="Business Type">B. Type</th>
            <th class="text-nowrap" title="Carrier">Carrier</th>
            <th class="text-nowrap" title="Premium">Premium</th>
            <th class="text-nowrap" title="Binder Date">Binder. D</th>
            <th class="text-nowrap" title="Effective Date">Effect. D</th>
            <th class="text-nowrap" title="Expiration Date">Exp. D</th>
            <th class="text-nowrap" title="CSR">CSR</th>
            <th class="text-nowrap" title="Producer">Producer</th>
            <th class="text-nowrap" title="Agent">Agent</th>
            <th class="text-nowrap" title="Policy Status">P. Status</th>
            <th class="text-nowrap" title="Product Line">P. Line</th>
          </tr>
        </thead>
        <tbody>
          <!-- DataTables fills this -->
        </tbody>
      </table>
    </div>
  </div>
</div>
</div>
<!-- / Content -->

<!-- Footer -->
<footer class="content-footer footer bg-footer-theme">
  <div class="container-xxl">
    <div class="footer-container d-flex align-items-center justify-content-between py-2 flex-md-row flex-column">
      <div>
        ©
        <script>document.write(new Date().getFullYear());</script>
        , &nbsp;
        <a href="https://goldentrust.com" target="_blank" class="footer-link text-primary fw-medium">
          GTI | Marketing & IT Department
        </a>
      </div>
      <div class="d-none d-lg-inline-block">
        <a href="https://goldentrust.com" class="footer-link me-4" target="_blank">GoldenTrust.com</a>
        <a href="https://admin.goldensoft.pro" target="_blank" class="footer-link me-4">CRM</a>
        <a href="https://365.goldentrustinsurance.com" target="_blank" class="footer-link me-4">Email</a>
        <a href="https://internal.goldentrustinsurance.com" target="_blank" class="footer-link me-4">Intranet</a>
      </div>
    </div>
  </div>
</footer>
<div class="content-backdrop fade"></div>
</div>
<!-- Content wrapper -->
    </div>
    <div class="layout-overlay layout-menu-toggle"></div>
    <div class="drag-target"></div>
  </div>

  <!-- JS: jQuery, DataTables y Buttons EN ESTE ORDEN -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.8/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.8/js/dataTables.bootstrap5.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.2/js/dataTables.buttons.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.html5.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.bootstrap5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="/vendor/libs/datatables-bs5/datatables-bootstrap5.js"></script>
  <script src="/vendor/libs/select2/select2.js"></script>
  <script src="/vendor/libs/sweetalert2/sweetalert2.js"></script>
  <script src="/vendor/libs/node-waves/node-waves.js"></script>
  <script src="/vendor/libs/perfect-scrollbar/perfect-scrollbar.js"></script>
  <script src="/vendor/libs/hammer/hammer.js"></script>
  <script src="/vendor/libs/i18n/i18n.js"></script>
  <script src="/vendor/libs/typeahead-js/typeahead.js"></script>
  <script src="/vendor/js/menu.js"></script>
  <script src="/js/main.js"></script>

  <!-- Tu JS específico para esta vista -->
  <script src="/js/csr-policies.js"></script>
  <script>
    // DataTables search input (global)
    $(document).ready(function () {
      $('#global-search').on('keyup', function () {
        $('#csr-policies-table').DataTable().search(this.value).draw();
      });
    });
  </script>
</body>
</html>